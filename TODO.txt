Потраченное время: 86 часа (00:00) 1 сентября -
----------------------------------------------------------------------------------------------------------
Сайт http://super-kadr32.ru/
Верстка http://kadr.test32.ru/templates/admin/orders.html

Требования
- Composer
- PHP 5.5
- memory_limit не меньше 256 (Загрузка файла через Croppic если увеличивать фото то ошибка вылетает)

Тестовый пользователь:
Test@mail.ru
test




1. Не совсем понятно, зачем генерируются сразу 5 плейлистов. Необходимо ведь генерировать плейлисты по-очередности, один за другим. Так как в этот момент может появиться новый заказ, который не сможет попасть в плейлист.
2. Необходимо разделить страницу плейлисты в админ-панеле на две - для каждого экрана.
3. Откорректировать размеры экранов (чтобы визуально соответствовали размерам реальных экранов) + поменять их местами. Лучше было бы конечно вывести куда-нибудь эту настройку.
4. Исправить описание тарифов, чтобы они соответствовали ТЗ



1) Генерацию 5 плейлистов я привел к примеру, что будет если не вызывать долго скрипт формирования плейлистов, так да он формирует плейлисты по очередности и не дает сформировать плейлисты в которые могут попасть новые заказы.
2) Готово
3) Поменял местами, по поводу размеров сделал в админке раздел Экраны, там можно задать размеры.
4) Поправил, в Базе данных можно изменить описание. URL БД http://super-kadr32.zualex.com/phpmyadmin/
доступы в файле .env





+ Административная панель
+ Посредник authAdmin - пропускает только пользователей с level = admin
+ Добавление администраторов и обычных пользователей
+ Независимые URL админке- то есть можно быстро изменить путь к админке 
---------------------------------------------------------------------------------------------------
+ Авторизация для Админа
+ Авторизация через соц сети: twitter, facebook, vk, od
+ Доступ к административной панели только для админов
+ Подключил верстку
---------------------------------------------------------------------------------------------------
+ Загрузка фото
+ Выбор тарифа (тарифы из базы данных)
+ Выбор экрана, пр выборе меняется размер мониора (У экранов есть свои настройки - размеры загружаемых картинок)
+ Выбор даты и времени показа
+ При загрузке картинки стоит проверка, что если высота или ширина изображения больше 10000px то вылетает ошибка (В целях безопасности)
+ Загрузить картинку может только авторизованный пользователь
+ Сохранение в базе данных галереи и заказа
+ Статусы для заказов и галереи
+ Вывод на главной галереи
+ Вывод детальной страницы галереи
---------------------------------------------------------------------------------------------------
+ Лайки
+ Вывод на главной 15 поплулярных галерей по кол-ву лайков за последний месяц, если не хватает 15, то добираются за весь период популярные
+ Вывод галереи в разделе галерея
+ Постраничная навигация
+ Комментарии
+ Изменить пароль админинстратора
+ Вывод Заказов в админ панеле
+ В заказах добавил вкладку Отменённые
+ В админ панеле в разделе заказы можно менять статусы (Массовое изменение статусов еще не сделано), то есть менять статусы заказам только тут пока что можно http://joxi.ru/xAeN7qLuddGZry
---------------------------------------------------------------------------------------------------
+ Массовая модерация в заказах
+ Теперь при переходе на не существующий url, выводиться 404 ошибка
+ Подключена ROBOKASSA, сейчас платежи идут через тестовый сервер, там не много своя особенность (http://joxi.ru/a2XaLR4T6VjNAg)
+ Возможно быстрое отключение ROBOKASSA
+ Поправил баги при загрузке изображений - сохранение с черной рамкой справа.
+ Поправил баги при смене экрана в плагине croppic
+ Все приходящие заявки сортируются по времени показа
+ Поделиться в соц сетях, на детальной станице галереи (инстаграм скрыл так как у них нельзя сделать поделиться. http://stackoverflow.com/questions/17673156/instagram-share-photo-from-webpage)
+ В админ панеле вывел настройки, их можно менять и сохранять
---------------------------------------------------------------------------------------------------
+ Исключил необходимость регистрации пользователя при заказе.
+ Формирование плейлистов:
Для того чтобы формировались плейлисты необходимо обращаться по URL: /cron/playlist/initfile
Алгоритм плейлиста:
1) В БД проверяет когда был сформирован последний плейлист
	а) Если данных нет то рассчитывается дата начала и дата конца плейлиста
	б) Если данные есть то определяет дату начала и дату конца плейлиста из БД
2) Если дата начала = 00:00:00 загружается в БД исходный плейлист который лежит по URL: \playlistFiles\Monitor1\init
3) Далее определяем заказы в очередь на формирование
4) Формирование плейлиста в папку: \resources\playlistFiles\Monitor1
	- название имеет вид: ПЛ20150920012435.xml
	- Изображения лежат тут: \resources\playlistFiles\Monitor1\images
5) Плейлисты формируются до даты начала следующего плейлиста на момент вызова скрипта. Например,
	- Сформированных плейлистов никаких нет
	- вызываем скрипт /cron/playlist/initfile в 2:05
	- Сформируется 5 плейлистов:
		1) 00:00 -  00:30
		2) 00:30 - 01:00
		3) 01:00 - 01:30
		4) 01:30 - 02:00
		5) 02:30 - 03:00
	- 6 плейлист сформируется при в 2:30




------
Идентификатор клиента: super-kadr32.test
Логин администратора: admin
E-Mail администратора: Azubarev32@yandex.ru
Пароль: rj754Rd4PK

Идентификатор магазина: super-kadr32.test
Пароль1: rj754Rd4PK
Пароль2: rj754Rd4PK234234

Параметры проведения тестовых платежей
Пароль1: testrj754Rd4PK
Пароль2: testrj754Rd4PK234234


Метод выбирать GET
URL:
- /pay/result
- /pay/success
- /pay/fail
------


Для тест соц сетей
TWITTER_ID = t3O4iFG6Dr9EIl54Rld5POdHp
TWITTER_SECRET = WNKnYcJMGmq5tB0Kqtj5YO4w3a6tfyjWAUo4pMZd7sUi1AXQUA
TWITTER_REDIRECT = http://super-kadr32.local/login/callback/twitter

FACEBOOK_ID = 171355216531108
FACEBOOK_SECRET = a4e393ea8c19de1cbcba85a4b764b06d
FACEBOOK_REDIRECT = http://super-kadr32.local/login/callback/facebook

VKONTAKTE_ID = 5057233
VKONTAKTE_SECRET = AzAIrYvYkOPfLhWBoU8A
VKONTAKTE_REDIRECT = http://super-kadr32.local/login/callback/vkontakte

ODNIKLASSNIKI_ID = 1111
ODNIKLASSNIKI_SECRET = 1111
ODNIKLASSNIKI_REDIRECT = http://super-kadr32.local/login/callback/odnoklassniki


Статусы:
statys_pay
- Оплачено
- Ожидание оплаты
- Ошибка
- Отклонено пользователем
- Отклонено администратором

status_main
- Одобрено
- На модерации
- Отклонено

status_order
- Выполнена
- В исполнении
- В очереди на исполнение

----------------------------------------------------------------------------------------------------------


ТЗ:
+ При выборе экрана менять экран, один из них квадратный
+ вместо поиска соц сети
+ Авторизация через соц. сети: Вконтакте, facebook, twitter, одноклассники.
+ лайки
+ Комментарии
+ Кнопки поделиться в соц. Сетях
+ страницы: Главная, Галерея, Детальная страница галереи
+ форма загрузки изображения – плагин croppic
+ Выбор тарифа и оплата
+ Подключение робокассы
+ Админ панель: Настройки, Транзакции, Заказы, Плейлисты
+ CMS Настройки:
	+ Название сайта
	+ возможность его выключить
	+ настройки для соц. Сетей(если не используем стороннего сервиса)
	+ настройки робокассы – логин, пароль и т.д.
+ CMS Транзакции (все платежы):
	+ ID – номер транзации в базе.
	+ Операция – описание транзации. Достаточно просто того, что можно увидеть, к какому заказу она относится по ID заказа в базе.
	+ Сумма – ну тут все понятно.
	+ Дата – время, когда была произведена операция
	+ Состояние: Оплачено, Ожидание оплаты, Ошибка или отклонено пользователем.
+ CMS Заказы:
	+ попадают только после оплаты
	+ Есть все заказы а есть одобренные
	+ Модератор может одобрить или отвергнуть заявку.
	+ Так же присутствует массовая модерация – выделить несколько элементов галочками и нажать на кнопку сверху.
	+ После модерации заявки, она отправляется в раздел одобренных – вторая вкладка.
	+ Модератор может удалить от сюда заказы по одному, а так же через массовую модерацию.
- CMS Плейлисты:	
	+ Плейлистов два – по количеству экранов(Отличаются только тем, что генерироваться будут из разных начальных плейлистов и с разным разрешением картинок.)
	+ три таблицы:
		+ 1:
			+ Исходные данные  приходит файл на фтп заносим данный в БД и выводим
		+ Вторая таблица – заказы в очереди на генерацию нового файла плейлиста:
			+ Должны удовлетворять условиям:
				+ Заказ одобрен модератором.
				+ Количество оставшихся показов не равно 0 – каждое внесение в плейлист уменьшает это значение.
				+ Промежуток времени между временем начала показа(пользователь выбрал при заказе) и окончанием показа(высчитывается по тарифу) соответствует времени, для которого генерируется наш плейлист.
				+ Ну и конечно выбирать заказы только для нужного экрана(тоже выбирает пользователь).

			
+1. Исключить необходимость регистрации пользователя при заказе.
+2. В админпанеле необходимо все приходящие заявки сортировать по времени показа, чтобы модератор мог одобрить сначала те, которые первыми должны попасть в плейлист.
+3. Исправить артефакты, появляющиеся при загрузке изображений - сохранение с черной рамкой справа.
